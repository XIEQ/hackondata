{
  "name": "Map Placement for City of Toronto Wayfinding Project",
  "tagline": "",
  "body": "\r\n# Toronto Apache Spark [HackOn(Data)](http://hackondata.com/) Event 2016\r\n**--1st Place Winner Solution - Map Placement for City of Toronto TO360 Wayfinding Project**\r\n\r\nQian(John) Xie, Mingfei Cao, and Roland Sing\r\n\r\n**[HackOnData](http://hackondata.com/)** is a free two-day event that brings together the Toronto data community to take a closer look at the data that touches our daily lives. Teams of Toronto's passionate data scientists and data engineers collaborated to generate practical insights from data provided by local companies, not-for profits and the government. Prior to the event, eight weekly workshops and challenges will help prepare participants by giving them the knowledge and hands-on experience required to ensure they can meaningfully participate. During the event, well-known mentors from Toronto and around the world engaged with participants to take their knowledge and skill to the next level. HackOn(Data) is the best platform available to local data talent and businesses to meet, collaborate, and exchange knowledge and experience.\r\n\r\n**Sponsers**  \r\nTranQuant, flipp, wattpad, LoyaltyOne, amazon, Lightbend, GuruLink, Shopify\r\n\r\n**Partners**  \r\nToronto Apache Spark, scalator, Deep Learning Toronto, HackerNest, HacherNest Toronto Tech Socials, TechToronto, DMZ, City of Toronto, Toronto Public Library\r\n\r\n# 0 Solution Notebooks\r\nThe solution is implemented in both Python and Spark (PySpark API). The solution notebooks are publicly availabel on my Github repository and on Databricks.\r\n\r\n* Python Solution\r\n  - <a href=\"http://nbviewer.jupyter.org/github/XIEQ/hackondata/blob/master/Map_Placement_City_of_Toronto.ipynb\"> View complete solution notebook through nbviewer</a>\r\n  - [Python solution notebook on my Github](https://github.com/XIEQ/hackondata/blob/master/Map_Placement_City_of_Toronto.ipynb)\r\n  \r\n* Spark solution was done using Databricks Community Edition, and the Databricks notebooks are available here:\r\n  - [Databricks Notebook 0: Project Overview](https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/8891646194974755/2498144867240658/6439822263820045/latest.html)\r\n  - [Databricks Notebook 1: Data Preparation](https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/8891646194974755/2498144867240604/6439822263820045/latest.html)\r\n  - [Databricks Notebook 2: Exploratory Analysis](https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/8891646194974755/2498144867240997/6439822263820045/latest.html)\r\n  - [Databricks Notebook 3: DBSCAN Clustering](https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/8891646194974755/2498144867240775/6439822263820045/latest.html)\r\n  - [Databricks Notebook 4: KMeans Clustering](https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/8891646194974755/2498144867240858/6439822263820045/latest.html)\r\n  - [Databricks Notebook 5: Map Placement Based on Clustering](https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/8891646194974755/2498144867240666/6439822263820045/latest.html)\r\n\r\n# 1 Project Overview\r\n\r\n## 1.1 Background and Motivation\r\nIn 2011, City of Toronto launched the TO360 Wayfinding Project. The integrated multi-modal wayfinding strategy is comprised of pedestrian, vehicular, cycling and transit wayfinding. The project is aimed to:\r\n* Enhance the overall image of Tonto as a destination\r\n* Increase visitors at key attractions, spending in the Greater Toronto Area, boost the local economy\r\n* Increase confidence to walk, reduce walk times, promote multi-modal transit and reduce auto use\r\n* Improve urban realm, sense of community, pedestrian safety, health and environment\r\n\r\nThe project is implemented in three phases:  \r\n* Phase 1: Wayfinding strategies (2011 - 2012)\r\n* Phase 2: Pilot implementation  (2014 - 2015)\r\n* Phase 3: City-wide roll out   (2016 - 2017)\r\n\r\nRight now, the project in in phase 3. In determining where wayfinding products are required, a number of factors were considered:\r\n\r\n**Existing Need** - The implementation strategy prioritizes areas where a need for wayfinding currently exists based on:  \r\n* having high densities of visitors who are unfamiliar with the city\r\n* having high pedestrian volumes\r\n* having changes in mode of travel\r\n* being on a main street\r\n* being an area that is difficult to navigate\r\n* being close to hospitals, colleges or universities\r\n* being close to a city center\r\n\r\n**Available Funding** - Further, certain areas may be prioritized as project partners come forward with funding to implement the scheme.  Potential project partners include:  \r\n* transit agencies\r\n* Business Improvement Areas\r\n* universities and health care campuses\r\n* attractions\r\n* city divisions\r\n* tourism organizations\r\n\r\n## 1.2 Objectives\r\nFor the **HackOn(Data)** event, City of Toronto have an interest in exploring a more data-driven methodology to determine the timing and geographic distribution of the required TO360 map assets upgrades. The data-driven methodology may help gain valuable insights from a different and novel perspective and help domain experts to make more effective and reliable map placement plan.\r\n\r\n**Reference**: [Toronto Wayfinding Strategy](http://www1.toronto.ca/wps/portal/contentonly?vgnextoid=8057524d63f02410VgnVCM10000071d60f89RCRD&vgnextchannel=d90d4074781e1410VgnVCM10000071d60f89RCRD)\r\n\r\n## 1.3 Our Approach\r\nWe choose an exploratory approach for this problem. We are not aiming to find a \"perfect\" solution by considering all needs and using all the available data. Instead, our goal is to build a prototype model using the a few of the most important data sources(provided by [TranQuant](http://tranquant.com/) and [City of Toronto Open Data](http://www1.toronto.ca/wps/portal/contentonly?vgnextoid=9e56e03bb8d1e310VgnVCM10000071d60f89RCRD)). If we can gain insights from the solution and the methodology is actionable, we can refine the prototype methodology by taking into consideration more needs, incooporating more data sources, and using more advanced algorithms.\r\n\r\nAmong the four aspects of the multi-modal wayfinding strategy, we focus on the **pedestrian wayfinding**. We chose to analyze two datasets from the City of Toronto, available on TranQuant:  \r\n* Cultural Spaces: This dataset is a compilation of all spaces within the 44 City wards that were available for cultural use for a five year period.\r\n* Signalized Intersection Traffic and Pedestrians: This dataset contains traffic and pedestrian volume data collected at intersections where there are traffic signals from 1999 to 2015.\r\n\r\n# 2 Data\r\n* Pedestrian and Vehicle Volume Data of Major Intersections\r\n  - `ped_vol_2012.csv`: pedestrian and vehicle volume data collected at some intersections in 2012 \r\n  - `ped_vol_2013.csv`: pedestrian and vehicle volume data collected at some intersections in 2013\r\n  - `ped_vol_2014.csv`: pedestrian and vehicle volume data collected at some intersections in 2014\r\n  - `ped_vol_2015.csv`: pedestrian and vehicle volume data collected at some intersections in 2015\r\n  - `signalizedTrafficPedestrianVolumes` - pedestrian and vehicle volume data collected at some intersections from 1999 - 2012\r\n\r\n* Cultural Facility Data  \r\n  The same data was provided in three formats\r\n  - `MSFC_44_Wards_Complete_Final.csv`: List of cultural facilities in Toronto. The file consists of the name of the facility, address, ward information, ownership of facilities that are available on a rental basis for cultural events. The two accompanying documents `MSFC_Readme_1.csv` and `MSFC_Readme_2.csv` give detailed describe the contents of the file and the schema(columns) of the file. The `MSFC_44_Wards_Complete_Final.csv` only provides postal code, no coordinates for facility.\r\n  - `Make_space_for_culture_mtm3.zip`:  with shape files of MTM 3 coordinate system and facility file `MAKE_SPACE_FOR_CULTURE.dbf`, which contains coordinates for facilities. \r\n  - `Make_space_for_culture_wgs84.zip`: with shape files for WGS84 coordinate system and facility file `MAKE_SPACE_FOR_CULTURE_WGS84.dbf`, which contains coordinates for facilities.\r\n\r\n# 3 Exploratory Data Analysis\r\n## 3.1 Pedestrian and Vehicle Volume Distribution\r\nIn this section, we will check intersection pedestrian and vehicle volume distribution to see what pattern they follows or to see whether there is any `interesting` behavior in the data.\r\n\r\n#### Pedestrian Volume Distribution\r\n<img src=\"images/Ped_vol_dist.png\" alt=\"Pedestrian Volume Distribution\">\r\n\r\n#### Vehicle Volume Distribution\r\n<img src=\"images/Veh_vol_dist.png\" alt=\"Intersections\">\r\n\r\n#### Intersections\r\n<img src=\"images/intersections.png\" alt=\"Intersections\">\r\nFrom the graph, we can see the shape of the City of Toronto and main street and how the intersections are distributed geographically.\r\n\r\n#### Cultural Facilities\r\n<img src=\"images/facilities.png\" alt=\"Facilities\">\r\nThis graph shows us the geographic distribution of cultural facilities according to their coordinates. It is no surprise that cultural facilities are condensed in downtown area of the City of Toronto.\r\n\r\n## 3.1 DBSCAN Clustering\r\nWe first tried [DBSCAN](http://scikit-learn.org/stable/modules/clustering.html#dbscan) algorithm in `scikit-learn` for clustering. DBSCAN is base on the paper:\r\n\r\n* “A Density-Based Algorithm for Discovering Clusters in Large Spatial Databases with Noise” Ester, M., H. P. Kriegel, J. Sander, and X. Xu, In Proceedings of the 2nd International Conference on Knowledge Discovery and Data Mining, Portland, OR, AAAI Press, pp. 226–231. 1996\r\n\r\nThis algorithm is aimed for spatial data, which might be a good fit for our case.\r\n\r\nThe following is a description of DBSCAN algorithm from sklearn:  \r\n>The DBSCAN algorithm views clusters as areas of high density separated by areas of low density. Due to this rather generic view, clusters found by DBSCAN can be any shape, as opposed to k-means which assumes that clusters are convex shaped. The central component to the DBSCAN is the concept of core samples, which are samples that are in areas of high density. A cluster is therefore a set of core samples, each close to each other (measured by some distance measure) and a set of non-core samples that are close to a core sample (but are not themselves core samples). There are two parameters to the algorithm, `min_samples` and `eps`, which define formally what we mean when we say dense. Higher `min_samples` or lower `eps` indicate higher density necessary to form a cluster.\r\n\r\nDBSCAN algorithm clusters dataset based on two parameters:\r\n\r\n * **eps** - The max distance between neighbor points to be considered in a cluster\r\n\r\n *  **min_samples** - the minimum cluster size. If it is set to 1, it means every data point will be assigned to either a cluster or form its own cluster of 1 data point. If `min_sample` is set to be larger than one, then cluster with size less than min_sample will be considered as noise.\r\n\r\nThe scikit-learn DBSCAN haversine distance metric requires data in the form of [latitude, longitude] and both inputs and outputs are in units of radians.\r\n\r\n#### Choose Parameters for DBSCAN clustering algorithm\r\nSince in our facility dataset, we need to consider all facilities, we don't want any of them to be classified as noise, so we set `min_samples`=1. Now our clustering will depend on a proper `eps` value.\r\n\r\nLet's try esp = 1.5, 1.0, 0.7 (km)\r\n\r\nNote that `eps` need to be converted to radians for use by harversine\r\n\r\n### 3.2.1 DBSCAN Clustering with eps = 1.5 km\r\n<img src=\"images/DBSCAN_1.5.png\" alt=\"DBSCAN eps = 1.5 km\">  \r\nAs we can see when we set eps = 1.5, the DBSCAN algorithm groups the cultural facilities into 20 clusters based on their geographic coordinates. The figure further proved the concept that:\r\n> \"DBSCAN algorithm views clusters as areas of high density separated by areas of low density. Due to this rather generic view, clusters found by DBSCAN can be any shape, as opposed to k-means which assumes that clusters are convex shaped.\"\r\n\r\nObviously, 20 cluster is not enough. We need a lot more than 20 intersections to place map. Let's adjust the `eps` parameter and see what result we can get.\r\n\r\n### 3.2.2 DBSCAN Clustering with eps = 0.7 km\r\n<img src=\"images/DBSCAN_1.0.png\" alt=\"DBSCAN eps = 1.0 km\">  \r\nWhen we set eps = 0.7, the DBSCAN algorithm groups the facilities into 185 clusters. From the plot we can clearly see that the core of downtown is a huge cluster, accounting for more than half of all facilities, while most other cluster only has one facility. This is not a reasonable clustering that we can base on to put maps. Let's try eps = 1.0 km and see if we can get a reasonable result.\r\n\r\n### 3.2.3 DBSCAN Clustering with eps = 1.0 km\r\n<img src=\"images/DBSCAN_0.7.png\" alt=\"DBSCAN eps = 0.7 km\">  \r\nWith eps = 1.0 km, the DBSCAN algorithm groups the facilities into 93 clusters. Again, downtown and middle down facilities are in the same huge cluster, and other facilities are rather nicely grouped. Based on these findings we learned that DBSCAN alone is not good enough for our needs, but it can be used to select the areas where facilities are dense and help implement a phase-wise plan for rolling out maps throughout the City of Toronto.\r\n\r\n## 3.3 DBSCAN for Phase-wise Implementation\r\nThe citywide roll-out of the map placement will be implemented through a 3-year plan as shown in the following map. \r\n* Year 1: Complete TO360 roll-out within Core of Downtown Toronto\r\n* Year 2: Focused roll-out of TO360 map in and around main streets, BIAs and transit hubs\r\n* Year 3: Citywide roll-out of TO360 map\r\n\r\n<img src=\"images/phase_implementation.PNG\" alt=\"Phase-wise implementation\">  \r\nDBSCAN algorithm can help to select the facilities for each phase of implementation.\r\n\r\n### 3.3.1 Downtown and Main street Facilities\r\nDowntown cluster is very condensed, it includes 1064 facilities out of the total 1397 facilities. Let's extract Downtown facilities based on previous DBSCAN clustering(eps = 1.0 km)  \r\n<img src=\"images/downtown_facilities.png\" alt=\"Downtown Facilities\">  \r\n\r\n### 3.3.2 Downtown Facilities Clustering\r\nSet eps = 0.4 km to further clustering downtown facilities, and then extract core downtown facilities based on DBSCAN clustering result.  \r\n<img src=\"images/downtown_DBSCAN_0.4.png\" alt=\"Downtown Clustering\">  \r\n\r\n### 3.3.3 Extract Core Downtown Facilities\r\n<img src=\"images/core_downtown_facilities.png\" alt=\"Core Downtown Facilites\">  \r\nThere are 655 facilities in the core of downtown Toronto\r\n\r\nNow, we have three groups of facilities: core downtown facilities, downtown and main streets facilities, and out of core facilities. With these three groups of facilities, we can implement the 3 year phase-wise plan for map roll-out. For each group of facilities we can then use KMeans clustering algorithm to further clustering them into small groups and then we can put a map near the centroid of each cluster of facilities.\r\n\r\n**Note**  \r\nIn current solution, we did not applied KMeans clustering to each of the three groups. Instead, we applied KMeans to the entire facility dataset to make a quick prototype. In future improvement, we can apply KMeans clustering to each of the three groups of facilities.\r\n\r\n## 3.4 KMeans Clustering\r\nIn this section, we use KMeans clustering algorithm to group cultural facilities according to their geographic coordinates.\r\n\r\n**Note**    \r\nHere we apply KMeans clustering to the entire facility dataset to get a general idea of how KMeans algorithm works for our problem. \r\n\r\n### 3.4.1 KMeans Clustering with 200 Clusters \r\n<img src=\"images/Kmeans_200.png\" alt=\"KMeans 200 clusters\">\r\nFrom the above plot we can see that 200 clusters might not be enough because the distance a map needs to cover is too long.\r\n\r\n### 3.4.2 KMeans Clustering with 300 Clusters\r\n<img src=\"images/Kmeans_300.png\" alt=\"KMeans 300 clusters\">\r\nWe will use 300 clusters as the prototype for later selection of intersections for map placement.\r\n\r\nThe following is plot of intersections and the 300 facility cluster centroids. The small blue dots represent intersections, the big black dots represent facility cluster centroids. Our goal now is to find the closet intersection for each cluster centroid. We are going to find a proper intersection for each of the centroid to place map.  \r\n<img src=\"images/fac_centroids_and_intersections.png\" alt=\"Facility Centroids and Intersections\">\r\n\r\n\r\n# 4 Selected Intersections for Map Placement\r\nNow we have 300 facilities clusters and their centroids, our goal is to find an appropriate intersection to place map for each facility cluster as shown in the following plot. \r\n\r\nWe compared two cases:  \r\n**Case 1**: Select the intersection that is closest to the centroid of a cluster  \r\n**Case 2**: Select the three closest intersections to  the centroid of a cluster, then among the three the closest intersections, we select the one with the highest pedestrian volume.\r\n\r\n**KDTree Algorithm**   \r\nTo find the closest intersection to a cluster centroid, we will use KDTree algorithm.\r\n\r\n## 4.1 Case1: Only Consider Distance\r\n<img src=\"images/selected_intersections_dist_only.png\" alt=\"Selected Intersections for Map Placement When Only Consider Distance\">\r\nIf we only consider distance, the average 8 hour pedestrian volume is 11246.8 for the select 296 intersections\r\n\r\n## 4.2 Consider Distance and Pedestrian Volume\r\n<img src=\"images/selected_intersections_dist_vol.png\" alt=\"Selected Intersections for Map Placement When Consider Distance and Pedestrian Volume\">\r\nIf we consider both distance and pedestrian volume, the average 8 hour pedestrian volume is 16004.4 for the selected 286 intersections. In other words intersections selected by this method has in average 4758 more pedestrian volume or 42% pedestrian volume in 8 Hour period compare to the intersection selected only considering distance. This is a huge difference. Therefore, we will select intersections using the second method, which considers both distance and pedestrian volume.\r\n\r\n\r\n# 5 Future Improvement\r\nThere is a lot we can do to improve our current solution: \r\n1. Explore other methodologies. Clustering is only one of the possible methodologies that may lead to a solution. We can also try other methodologies and compare the results. Formulating the problem as an optimization problem is a worth trying direction. Or we can combine clustering and optimization by applying optimization to each clusters.\r\n\r\n2. Using more point of interest data. In our current study, we only used 1397 cultural facilities for building our solution. There is a lot more point of interest(such as hospitals, colleges or universities, attractions, commercial areas, etc.) we need to incorporate to make the study representative.\r\n\r\n3. Consider more needs when choose an intersection for map placement. In our current study, we considered distance and pedestrian volume. Other needs we should consider include:\r\n  * having high densities of visitors who are unfamiliar with the City\r\n  * having changes in mode of travel\r\n  * being on a main street\r\n  * being in an area that is difficult to navigate\r\n  * being close to hospitals, colleges or universities\r\n  * being close to a city center  \r\n    \r\n4. Insights from domain experts. City planners have more practical insights on whether an intersection is appropriate for map placement. We can improve our solution by taking advises from domain experts.\r\n\r\n\r\n",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}